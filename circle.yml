dependencies:
  pre:
    - pip install cpplint
    - pip install git+https://github.com/alexandred/cldoc.git --user
    - echo 'export PATH=~/Library/Python/2.7/bin:$PATH' >> ~/.bashrc
    - git submodule init && git submodule update
    - brew tap tcnksm/ghr
    - brew install ghr

machine:
  xcode:
    version: "9.0"

test:
  override:
    - set -o pipefail &&
      xcodebuild
        -workspace "VoodooI2C.xcworkspace"
        -scheme "VoodooI2C"
        -derivedDataPath build 
        clean build


deployment:
  release:
    branch: master
    commands:
      - export VOODOOI2C_VERSION="$(cat version.txt)" && cd build/Build/Products/Release && mkdir Archives && zip -r Archives/"VoodooI2C-($VOODOOI2C_VERSION).zip" *.kext && zip -r Archives/"VoodooI2C-Debug-Symbols-($VOODOOI2C_VERSION).zip" *.dSYM && ghr --username alexandred --token $GITHUB_TOKEN --replace $VOODOOI2C_VERSION Archives/