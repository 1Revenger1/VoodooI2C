dependencies:
  pre:
    - git clone https://github.com/alexandred/cldoc && python cldoc/setup.py install
    - git submodule init && git submodule update
    - brew update
    - brew tap tcnksm/ghr
    - brew install ghr

machine:
  xcode:
    version: "7.3"

test:
  override:
    - set -o pipefail &&
      xcodebuild
        -verbose 
        -workspace "VoodooI2C.xcworkspace"
        -scheme "VoodooI2C" 
        clean build


deployment:
  release:
    branch: master
    commands:
      - export VOODOOI2C_VERSION="$(cat version.txt)" && cd build/Release && zip -r VoodooI2C.zip VoodooI2C.kext && ghr --username alexandred --token $GITHUB_TOKEN --replace $VOODOOI2C_VERSION VoodooI2C.zip